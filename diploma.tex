\documentclass{fefu}

\begin{document}
	\setschool{ШКОЛА ЕСТЕСТВЕННЫХ НАУК}
	\setdepartment{кафедра информатики, математического и компьютерного 
	моделирования}{А.Ю.Чеботарев}
	\setgroup{Б8403а}
	\title{о прохождении преддипломной практики\\направление подготовки 01.03.02 
	Прикладная математика и информатика\\профиль «Системное программирование»}
	\setdates{29}{апреля}{2019}{22}{июня}{2019}
	\setweeks{8}
	\setplace{кафедре информатики, \\математического и компьютерного \\моделирования}
	\author{Куцелабский Е.С.}
	\setsupervisor{Петров П.С.}
	
	\makereporttitle
	\tableofcontents
	\newpage
	
	\begin{abstract}
		\par Целью работы является разработка текстового редактора для 
		open-source движка Citrus. 
		В работе изложены особенности реализации и принятые решения.
		Выполнено сравнение производительности между предыдущей версией редактора и
		теперешней (\textbf{не очень слово}) реализацией.
	\end{abstract}

	\section{Введение}
		\subsection{Глоссарий}
			\begin{itemize}
				\item Текстовый редактор - 
				\item Игровой движок - 
				\item Сборка проекта -
				\item Линковка библиотек -
				\item Сериализация - 
				\item \textbf{Частота кадров -}
			\end{itemize}
		\subsection{Описание предметной области}
			\subsubsection{Студия Game Forest}
				\par Заказчиком данной работы выступает студия Game Forest. \cite{GFPortal} 
				\textbf{Нужно обернуть в кавычки?} Студия занимается созданием игр, и
				за время своего существования выпустила более 40 проектов, суммарная аудитория 
				которых - более 100 млн человек. Игровые проекты получали высокие оценки
				игроков, критиков и издателей, наиболее успешной игрой, в данный момент,
				является Gummy Drop (количество скачиваний - более 50 млн). 
				\cite{GummyDropPage}
				\par Основой игровых проектов, в данный момент, является разработка студии -- 
				игровой движок Citrus. Он позволяет создавать приложения для нескольких
				платформ: Windows, MacOS, Android, iOS.
				\par Несмотря на существование крупных открытых \textbf{Подобрать
				слово получше} игровых движков, таких как Unity и Unreal Engine, в Game Forest
				было принято решение использовать собственную разработку. К такому же решению
				пришли многие крупные компании, например, Bethesda Game Studios 
				\cite{BethesdaEngine} и id Software \cite{idSoftwareEngine}.
				\par Крупные \textbf{открытые} движки содержат инструменты для разработки игр
				всех жанров. Создание и поддержка подобных инструментов даже на базовом уровне
				требует огромных усилий, а учитывая тот факт, что подобные движки рассчитаны
				на массовую (часто непрофессиональную) аудиторию, комфорт и простота
				использования ставятся превыше производительности, что отрицательно сказывается
				на конечном продукте. Именно поэтому компании принимают решение о разработке
				собственных движков, создаваемых с учетом нужд компании. В подобных движках
				отсутствуют лишние компоненты, присущие массовым движкам, что позволяет
				сосредоточиться на улучшении действительно важных частей системы.
				\par Стоит отметить, что, в отличие от большей части компаний, студия Game
				Forest распространяет свой движок под лицензией GPL-3.0, что позволяет
				использование, модификацию и распространение движка другими студиями и
				отдельными пользователями.
			\subsubsection{Игровой движок Citrus}
				\par Citrus состоит из нескольких взаимосвязанных модулей, каждый из которых
				реализует определенную функциональность: \cite{CitrusRepo}
				\begin{itemize}
					\item Lime - ядро движка
					\item Lemon - линковка сторонних библиотек
					\item Kumquat - генерация кода
					\item Yuzu - сериализация
					\item Orange - сборка проектов
					\item Tangerine - редактор сцен
				\end{itemize}
				\par Движок позволяет визуализацию 2D и 3D графики, оконных интерфейсов,
				поддерживает воспроизведение звуков, сборку проектов для нескольких платформ,
				проигрывание и редактирование анимаций (в визуальном редакторе). Компоненты
				активно дорабатываются, набор поддерживаемых функций, при необходимости,
				дополняется.
				\par В модуле Lime, помимо прочего, содержатся части системы, ответственные за
				работу с текстом.
			\subsubsection{Текстовый редактор}
				\par Текстовый редактор это компьютерная программа (или её часть), 
				предназначенная для создания и изменения текстовых данных (в том числе 
				текстовых файлов). Часто редакторы предоставляют пользователям дополнительные 
				возможности, такие как: копирование и вставка, поиск и замена текста, 
				форматирование текста (переносы строк, выравнивание и пр.), 
				откат/восстановление изменений. 
				\par Некоторые редакторы, помимо работы с обычным текстом, позволяют также и
				работу со стилизованным текстом (т.н. \textbf{rich text}). Так как текстовый
				формат данных не предполагает хранения информации о стиле текста, в редакторах
				тексты обрамляются в различные языки разметки (например, HTML), либо
				используется внутреннее двоичное представление.
				\par Редакторы делятся на строковые (текст представлен в виде набора строк, 
				работа одновременно ведется только в одной строке) и экранные (пользователь
				может перемещать курсор в тексте, работа с текстом ведется в позиции курсора).
				В движке Citrus используются экранные текстовые редакторы.
				\par Для успешной работы текстового редактора необходимо, чтобы были
				реализованы три его основные компоненты: \cite{CraftOfTextEditing}
				\begin{enumerate}
					\item Обработка внутреннего представления текста - текст необходимо
					эффективным образом хранить и изменять, наивный подход к этой части
					редактора приведёт к значительному (в случае работы с большими объемами
					данных - к фатальному) падению производительности всего редактора.
					\item Отрисовка - текст необходимо правильно отрисовать с учетом размеров
					окна и применённых стилей (шрифт, выравнивание, переносы слов).
					\item Обработка пользовательского ввода - приём команд
					(вставка, удаление элемента, перевод курсора и~пр.) и передача их
					обработчику внутреннего представления.
				\end{enumerate}
			\subsubsection{Обработка текста в Citrus}
				\par Представление текстовых данных и работа с ними - важная часть игрового
				движка, поскольку значительная часть важной игровой информации сообщается 
				пользователю в текстовом виде. \textbf{Стоит ли здесь подробно писать про
				классы типа Editor, SimpleText, RichText?} Средствами движка реализованы 
				классы, позволяющие ввод и отрисовку текста, однако они реализованы
				неэффективно, что выражается в резком падении производительности с увеличением
				числа обрабатываемых данных. Это приводит к увеличению
				требований к процессору для поддержания высокой частоты кадров. При дальнейшем
				увеличении объема текста работа программ сильно замедляется, что критично для
				игровых проектов, и составляет значительные неудобства при работе со средствами
				визуального редактирования в движке. Также стоит отметить, что несмотря на
				возможность корректно отображать многострочный текст, текущая система слабо
				приспособлена для его редактирования.
				\par В данный момент эти проблемы решаются обходным путём, т.е. число
				использований многострочного редактора сведено к минимуму, а появления больших
				объемов текста стараются, по возможности, не допускать. В игровых проектах
				число больших текстов невелико, а во время работы с визуальной частью движка
				неэффективность работы текстовой системы, хоть и замедляет работу, не является
				критическим препятствием.
				\par Для решения данных проблем можно переписать всю систему работы с текстом с
				нуля, а можно лишь оптимизировать слабые части. Поскольку разработка подобной
				системы связана со значительными трудностями, в то время как на уже
				существующую систему опираются многие игровые проекты, я решил лишь внести 
				необходимые изменения в существующую структуру работы. \textbf{Третий вариант?}
				\par Архитектуру полученного текстового редактора, потенциально, можно
				использовать для реализации нового редактора для нужд других проектов, однако
				использование конкретно этого редактора затрудняется сильной его связанностью
				с компонентами движка Citrus, поскольку во многом он опирается на его
				библиотеки.	
		\subsection{Неформальная постановка задачи}
			В рамках данной работы требуется выполнить следующие задачи:
			\begin{enumerate}
				\item Изучить имеющиеся подходы к реализации текстовых редакторов
				\item Реализовать текстовый редактор согласно формальным требованиям,
				реализовать необходимую для нужд компании Game Forest функциональность.
				\item Сравнить производительность предыдущей версии редактора и этой 
				реализации.
			\end{enumerate}
		\subsection{Математические методы}
			\textbf{Опускаем раздел, все структуры данных в разделе 8}	
		\subsection{Обзор существующих методов решения}
			\textbf{Вынести в раздел 1го уровня}
			\par \textbf{Тут пишу про просто string, Piece table, rope, gap buffer и прочее}
			\par \textbf{Тут про то, что можно рисовать эффективно, можно неэффективно}
			\subsubsection{Внутреннее представление текста}
				\par Для хранения и обработки текстовых данных используются различные подходы,
				хотя общее число зарекомендовавших себя относительно невелико.
				У них есть как преимущества, так и недостатки, и, в зависимости от решаемой
				задачи, выбирается наиболее подходящий.
				\subsubsection*{Массив}

			\begin{center}
				\begin{tabular}{ |l|c|r|}
					\hline
					a & b & c \\
					\hline
				\end{tabular}
			\end{center}
			\par А сюда вывод пихнём
		\subsection{План работ}
			\par \textbf{ТОЛЬКО ДЛЯ ПРЕДДИПЛОМНОЙ ПРАКТИКИ}
			\begin{itemize}
				\item Изучение подходов к реализации текстовых редакторов (1-2 недели)
				\item Изучение кодовой базы движка Citrus в целях нахождения места для внесения
				изменений (1 неделя)
				\item Реализация текстового редактора (4 недели) \textbf{Какая-то тавтология 
				да и звучит сомнительно}
				\item Подготовка отчёта (1 неделя) \textbf{Это вообще в план должно входить?}
			\end{itemize}
			\textbf{Суммарно набралось 8 месяцев - длительность практики.}
	\section{Требования к окружению}
		\subsection{Требования к аппаратному обеспечению}
			\textbf{Пишу для цитруса}
			\begin{itemize}
				\item GPU с поддержкой Vulkan
				\item CPU Apple A6  или лучше
			\end{itemize}
		\subsection{Требования к программному обеспечению}
			\begin{itemize}
				\item ОС Windows 8.1 или выше; MacOS 10 или выше; дистрибутивы 
				Linux, поддерживающие среду Mono; Android 5 или выше; iOS 10.3.3 или выше
			\end{itemize}
			\textbf{А может я писал библиотеку? Тогда надо писать про всякие .Net}
		\subsection{Требования к пользователям}
			\textbf{Кажется, у меня их нет}
		\subsection{Организационные требования}
			\textbf{Опускаем раздел}
	\section{Архитектура системы}
		\par \textbf{ТУТ НАДО ПИСАТЬ ПРО ВИДИМОЕ ДЛЯ ПОЛЬЗОВАТЕЛЕЙ, А ВИДИМЫЕ ТОЛЬКО 
		КОМОНТЕКСТ И ЭДИТОР. Пожалуй, весь этот текст надо перенести в раздел 8 "Модули и
		алгоритмы}
		\par Система состоит из следующих модулей \textbf{А может не надо конкретных названий
		и стоит написать в общих чертах? Нужно ли писать про классы, которые я почти не 
		трогал (например, про Renderer и TextParser)?}:
		
		\begin{itemize}
			\item PieceTree - структура данных \textbf{Вообще-то класс} для обработки 
			внутреннего представления текста
			\item SubEditor - класс, обеспечивающий доступ к PieceTree и служащий для 
			обработки вызовов высокого уровня \textbf{Это так пишется?} (например, 
			"Переместить курсор", "Вставить символ")
			\item TextParser - класс, назначение которого - выделить набор фрагментов -- слов, 
			пробелов, переносов строки -- из исходного текста
			\item TextRenderer - класс, в котором слова разделяются по строкам с учетом 
			максимальных размеров виджета, а затем каждой строки вычисляется её позиция 
			в пикселях
			\item Renderer - класс, выполняющий отрисовку текста
			\item CommonText - связующее звено между модулями
			\item Editor - класс, обеспечивающий обработку пользовательского ввода (и 
			передачу соответствующих команд низкоуровневым модулям)
		\end{itemize}
	\section{Спецификация данных}
		\subsection{Описание формата или структуры данных}
			\textbf{Тут стоит написать про тэги в тексте, да?}
		\subsection{Описание сущности}
			\textbf{Опускаем раздел}
		\subsection{Описание протокола}
			\textbf{Опускаем раздел}
	\section{Функциональные требования}
		\par Тут надо понаписать много-много всего
		\subsection{Библиотека подпрограмм(классов)}
			\par Самый главный раздел в мире, описываем все классы мира, а их у меня 
			достаточно.
			\par Еще всякие схемы данных и прочее
	\section{Требования к интерфейсу}
		\textbf{С точки зрения UI стоит написать про Editor и CommonText, а именно про 
		шрифты, поддержку переносов, переносы слов и всё такое. С точки зрения API надо писать
		про вещи в духе "Вставить текст" или "Отменить выделение". А нужно ли писать про API?}
	\section{Прочие требования}
		\subsection{Требования к надежности}
			\par В случае возникновения ошибок, возможны падения приложений у игроков. Это 
			отрицательным образом сказывается на их вовлеченности в игровой процесс, что
			приводит к падению экономических показателей.
			\par Для предотвращения подобных ситуаций стоит провести тщательное тестирование
			программного кода на предмет ошибок (на низком уровне - с помощью 
			юнит-тестирования, на высоком - силами штатных тестировщиков).
		\subsection{Требования к безопасности}
			\textbf{Опускаем раздел или пишем про текстовые поля для ввода паролей}
		\subsection{Требования к производительности}
			Вся цепочка операций (от обработки изменений текста до 
			отрисовки) должна выполняться не более чем за 30 миллисекунд (для отрисовки 30 
			кадров в секунду).
	\section{Проект}
		\subsection{Средства реализации}
			Все части системы были реализованы на языке C\# 7.0, 
			версия .NET Framework 4.7.1, поскольку это стандарт для компании Game Forest.
		\subsection{Структуры данных}
			\textbf{Рассказать про PieceTree, нарисовать схемы}
		\subsection{Модули и алгоритмы}
			\textbf{Переносим из раздела выше и добавляем подробностей}
		\subsection{Проблемы и решения}
			\par В ходе разработки пришлось столкнуться со следующими \textbf{дописать 
			подводку}
			\begin{itemize}
				\item Предыдущий код TextRenderer трудно читается из-за функций размером в
				200 строк. Рефакторинг значительно улучшил читаемость \textbf{А мои функции 
				усложнили ха-ха}
				\item \textbf{Что-то там еще было}
			\end{itemize}
		\subsection{Стандарт кодирования}
			\textbf{Пишем стандарт Game Forest}
		\subsection{Проект интерфейса}
			\textbf{Вставить снимок CommonText что-ли}
	\section{Реализация и тестирование}
		\textbf{Всё по плану}
		\subsection{Вычислительный эксперимент}
			\textbf{Тут вставить обещанное исследование/сравнение производительности}
	\section*{Заключение}
		\textbf{Всё по плану}
	\newpage
	\bibliographystyle{ugost2008ls}
	\bibliography{references}
	
\end{document}